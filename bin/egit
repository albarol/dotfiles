#!/usr/bin/env bash

GREEN="\e[32m"
RED="\e[31m"
DIM="\e[2m"
BOLD="\e[1m"
NC="\e[0m"

message_help() {
printf  "\
\$ egit [comand] [arguments]

${BOLD}Usage:${NC}
 egit ${GREEN}bs${NC}       [--allow-remote | -r] <pattern>
 egit ${GREEN}clear${NC}

${BOLD}Commands:${NC}
 ${GREEN}bs${NC}            Searching for patterns on remote/local branches.
 ${GREEN}clear${NC}         Clear all orig files.

${BOLD}Options:${NC}
${GREEN}--h${NC}elp     Display this help.
"
}

process_branch_search() {
    if [[ "$#" -lt 1 ]]; then
        printf "${RED}Usage: egit bs [--allow-remote | -r] <pattern>${NC}\n"
        exit 1
    fi

    local ALLOW_REMOTE=""
    if [[ "$1" = "--allow-remote" ]] || [[ "$1" = "-r" ]]; then
        shift
        ALLOW_REMOTE="-a"
    fi

    git branch $ALLOW_REMOTE|grep --color -w $1
    exit 0
}

process_clear() {
    find . -name '*.orig' -delete
}

process_commands() {
    local cmd=$1
    shift

    case $cmd in
        bs) process_branch_search $@;;
        clear) process_clear;;
        *) message_help;;
    esac
}


if [[ "${@:-1}" = "--help" ]] && [[ "$#" -eq 1 ]]; then
    message_help && exit 0
elif [[ "$#" -ge 1 ]]; then
    process_commands $@
else
    message_help && exit 0
fi

